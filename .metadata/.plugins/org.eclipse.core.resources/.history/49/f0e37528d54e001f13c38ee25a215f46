/*
 * position.c
 *
 *  Created on: Jul 23, 2024
 *      Author: RND_220516
 */

// Includes
#include "distance.h"
#include "config.h"
#include "velocity.h"
#include "main.h"


// Variables
uint8_t is_distance_start = 1;
uint32_t start_time;
uint32_t current_time;
uint32_t elapse_time;
float target_time;

// Function Prototypes

// Functions
float Cal_Distance_To_Time(float target_distance, float velocity)
{
	float move_time = (target_distance / velocity) - ACCELERATION_TIME;

	return move_time; 	// second
}

void Distance(float *target_distance, float *target_velocity)
{
	*target_velocity = 0.1;

	target_time = Cal_Distance_To_Time(*target_distance, *target_velocity);	// second

	if (is_distance_start)
	{
		is_distance_start = 0;
		start_time = HAL_GetTick();
	}
	current_time = HAL_GetTick();

	elapse_time = (current_time - start_time) / MS_TO_SEC;

	if (elapse_time > target_time)
	{
		*target_velocity = 0;
		*target_distance = 0;
		is_distance_start = 1;
	}
}
